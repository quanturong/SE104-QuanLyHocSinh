<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tra c·ª©u h·ªì s∆° h·ªçc sinh</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body class="page-student">
  <div class="layout">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">üéì</div>
        <span>Student Management ‚Äì Qu·∫£n l√≠ h·ªçc sinh</span>
      </div>
      <nav class="nav">
        <a href="./tablecontrol.html">B·∫£ng ƒëi·ªÅu khi·ªÉn</a>
        <a href="./student.html">H·ªçc sinh</a>
        <a href="./class.html">L·ªõp h·ªçc</a>
        <a href="./attendance.html">ƒêi·ªÉm danh</a>
        <a href="./report.html">B√°o c√°o</a>
        <a href="./scoretable.html">ƒêi·ªÉm s·ªë</a>
        <a href="./timetable.html">Th·ªùi kh√≥a bi·ªÉu</a>
        <a class="active" href="./find.html">Tra c·ª©u</a>
        <a href="./teacher.html">Gi√°o vi√™n</a>
        <a href="./rules.html">Quy ƒë·ªãnh</a>
          
      </nav>
      <div class="spacer"></div>
      <a class="nav logout" href="../login.html">ƒêƒÉng xu·∫•t</a>
    </aside>
    <main class="main">
      <div class="page-header">
        <h1 class="page-title">Tra c·ª©u h·ªì s∆° h·ªçc sinh</h1>
        <p class="page-desc">Nh·∫≠p M√£ h·ªçc sinh (MSHS) ho·∫∑c H·ªç t√™n ƒë·ªÉ xem to√†n b·ªô h·ªì s∆°.</p>
      </div>
      <section class="card" style="margin-bottom:16px;">
        <div class="toolbar">
          <input class="input" id="q" placeholder="Nh·∫≠p MSHS ho·∫∑c h·ªç t√™n..." style="min-width:280px;" />
          <button class="btn" id="btn-search">üîé Tra c·ª©u</button>
          <button class="btn btn-export" id="btn-print">üñ®Ô∏è In h·ªì s∆°</button>
          <span class="muted" id="hint"></span>
        </div>
      </section>
      <div id="result" style="display:none;">
        <section class="card" style="margin-bottom:16px;">
          <div class="profile">
            <div class="avatar" id="pf-avatar">NA</div>
            <div>
              <h2 class="p-name" id="pf-name">‚Äî</h2>
              <p class="p-sub" id="pf-sub">MSHS: ‚Äî ¬∑ L·ªõp hi·ªán t·∫°i: ‚Äî</p>
              <div style="margin-top:6px;">
                <span class="pill" id="pf-dob">Ng√†y sinh: ‚Äî</span>
                <span class="pill" id="pf-gender">Gi·ªõi t√≠nh: ‚Äî</span>
                <span class="pill" id="pf-phone">ƒêi·ªán tho·∫°i: ‚Äî</span>
                <span class="pill" id="pf-address">ƒê·ªãa ch·ªâ: ‚Äî</span>
              </div>
            </div>
          </div>
        </section>
        <section class="grid cols-4" style="margin-bottom:16px;">
          <div class="card stat-mini">
            <div class="stat-mini-label">ƒêi·ªÉm TB cao nh·∫•t</div>
            <div class="stat-mini-value" id="st-best">‚Äî</div>
          </div>
          <div class="card stat-mini">
            <div class="stat-mini-label">ƒêi·ªÉm TB th·∫•p nh·∫•t</div>
            <div class="stat-mini-value" id="st-worst">‚Äî</div>
          </div>
          <div class="card stat-mini">
            <div class="stat-mini-label">V·∫Øng (t·ªïng c√°c k·ª≥)</div>
            <div class="stat-mini-value" id="st-abs">‚Äî</div>
          </div>
          <div class="card stat-mini">
            <div class="stat-mini-label">H·∫°nh ki·ªÉm (g·∫ßn nh·∫•t)</div>
            <div class="stat-mini-value" id="st-conduct">‚Äî</div>
          </div>
        </section>
        <div id="years"></div>
      </div>
      <section class="card" id="no-data" style="display:none;">
        <p class="muted">Kh√¥ng t√¨m th·∫•y h·ªçc sinh ph√π h·ª£p. H√£y ki·ªÉm tra l·∫°i MSHS/H·ªç t√™n.</p>
      </section>
    </main>
  </div>

  <script>
    const STUDENTS = [
      {
        id: "24001",
        name: "Nguy·ªÖn Di·ªáu Anh",
        gender: "N·ªØ",
        dob: "2007-05-12",
        phone: "0901 234 567",
        address: "123 Nguy·ªÖn Tr√£i, Q.5, TP.HCM",
        currentClass: "12C3",
        years: [
          {
            year: "2022 - 2023",
            annualAvg: 8.2,
            conduct: "T·ªët",
            ranking: "Gi·ªèi",
            semesters: [
              { name: "HK1", absences: 2 },
              { name: "HK2", absences: 1 }
            ],
            subjects: [
              { subject: "To√°n", sem: "HK1", d1p: 8.0, d15: 8.5, dck: 8.2 },
              { subject: "To√°n", sem: "HK2", d1p: 8.4, d15: 8.3, dck: 8.5 },
              { subject: "VƒÉn", sem: "HK1", d1p: 7.7, d15: 7.8, dck: 8.0 },
              { subject: "VƒÉn", sem: "HK2", d1p: 8.1, d15: 8.2, dck: 8.0 }
            ]
          },
          {
            year: "2023 - 2024",
            annualAvg: 8.6,
            conduct: "T·ªët",
            ranking: "Gi·ªèi",
            semesters: [
              { name: "HK1", absences: 1 },
              { name: "HK2", absences: 1 }
            ],
            subjects: [
              { subject: "To√°n", sem: "HK1", d1p: 8.7, d15: 8.8, dck: 8.9 },
              { subject: "To√°n", sem: "HK2", d1p: 8.5, d15: 8.7, dck: 8.8 },
              { subject: "VƒÉn", sem: "HK1", d1p: 8.2, d15: 8.3, dck: 8.4 },
              { subject: "VƒÉn", sem: "HK2", d1p: 8.1, d15: 8.2, dck: 8.2 }
            ]
          },
          {
            year: "2024 - 2025",
            annualAvg: 8.8,
            conduct: "T·ªët",
            ranking: "Gi·ªèi",
            semesters: [
              { name: "HK1", absences: 0 },
              { name: "HK2", absences: 0 }
            ],
            subjects: [
              { subject: "To√°n", sem: "HK1", d1p: 8.6, d15: 8.9, dck: 8.8 },
              { subject: "VƒÉn",  sem: "HK1", d1p: 8.5, d15: 8.7, dck: 8.8 }
            ]
          }
        ]
      },
      {
        id: "24002",
        name: "Tr·∫ßn Minh Qu√¢n",
        gender: "Nam",
        dob: "2007-10-02",
        phone: "0908 888 888",
        address: "45 L√™ L·ª£i, Q.1, TP.HCM",
        currentClass: "11B1",
        years: [
          {
            year: "2023 - 2024",
            annualAvg: 7.3,
            conduct: "T·ªët",
            ranking: "Kh√°",
            semesters: [
              { name: "HK1", absences: 3 },
              { name: "HK2", absences: 2 }
            ],
            subjects: [
              { subject: "To√°n", sem: "HK1", d1p: 7.0, d15: 7.2, dck: 7.4 },
              { subject: "VƒÉn",  sem: "HK1", d1p: 7.0, d15: 7.1, dck: 7.2 },
              { subject: "To√°n", sem: "HK2", d1p: 7.1, d15: 7.3, dck: 7.5 }
            ]
          }
        ]
      }
    ];

    function round1(x){ return Math.round(x*10)/10; }
    function calcAvg(d1p, d15, dck){
      return round1((d1p*1 + d15*2 + dck*3)/6);
    }

    function fillProfile(s){
      const initials = s.name.split(' ').map(p => p[0]).slice(-2).join('').toUpperCase();
      document.getElementById('pf-avatar').textContent = initials || 'HS';
      document.getElementById('pf-name').textContent = s.name;
      document.getElementById('pf-sub').textContent  = `MSHS: ${s.id} ¬∑ L·ªõp hi·ªán t·∫°i: ${s.currentClass}`;
      document.getElementById('pf-dob').textContent  = `Ng√†y sinh: ${new Date(s.dob).toLocaleDateString('vi-VN')}`;
      document.getElementById('pf-gender').textContent = `Gi·ªõi t√≠nh: ${s.gender}`;
      document.getElementById('pf-phone').textContent = `ƒêi·ªán tho·∫°i: ${s.phone}`;
      document.getElementById('pf-address').textContent = `ƒê·ªãa ch·ªâ: ${s.address}`;
      const avgs = s.years.map(y => y.annualAvg);
      const best = Math.max(...avgs), worst = Math.min(...avgs);
      const absTotal = s.years.reduce((t,y)=>t + y.semesters.reduce((a,b)=>a+b.absences,0),0);
      const latestConduct = s.years[s.years.length-1]?.conduct || '‚Äî';
      document.getElementById('st-best').textContent = best.toFixed(1);
      document.getElementById('st-worst').textContent = worst.toFixed(1);
      document.getElementById('st-abs').textContent = absTotal;
      document.getElementById('st-conduct').textContent = latestConduct;
    }

    function yearBlock(y){
      const rowsHK1 = y.subjects.filter(x=>x.sem==='HK1').map((x,i)=>`
        <tr>
          <td class="text-center">${i+1}</td>
          <td>${x.subject}</td>
          <td class="text-center">${x.d1p}</td>
          <td class="text-center">${x.d15}</td>
          <td class="text-center">${x.dck}</td>
          <td class="text-center"><span class="score ${scoreClass(calcAvg(x.d1p,x.d15,x.dck))}">${calcAvg(x.d1p,x.d15,x.dck)}</span></td>
        </tr>`).join('') || `<tr><td colspan="6" class="text-center muted">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>`;

      const rowsHK2 = y.subjects.filter(x=>x.sem==='HK2').map((x,i)=>`
        <tr>
          <td class="text-center">${i+1}</td>
          <td>${x.subject}</td>
          <td class="text-center">${x.d1p}</td>
          <td class="text-center">${x.d15}</td>
          <td class="text-center">${x.dck}</td>
          <td class="text-center"><span class="score ${scoreClass(calcAvg(x.d1p,x.d15,x.dck))}">${calcAvg(x.d1p,x.d15,x.dck)}</span></td>
        </tr>`).join('') || `<tr><td colspan="6" class="text-center muted">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>`;

      const absHK1 = y.semesters.find(s=>s.name==='HK1')?.absences ?? 0;
      const absHK2 = y.semesters.find(s=>s.name==='HK2')?.absences ?? 0;

      return `
      <section class="card" data-year="${y.year}">
        <div class="year-header">
          <div>
            <h3 class="p-name" style="font-size:18px;">NƒÉm h·ªçc ${y.year}</h3>
            <div class="muted">ƒêi·ªÉm TB c·∫£ nƒÉm: <strong>${y.annualAvg.toFixed(1)}</strong> ¬∑ H·∫°nh ki·ªÉm: <strong>${y.conduct}</strong> ¬∑ X·∫øp lo·∫°i: <strong>${y.ranking}</strong></div>
          </div>
          <button class="collapse-btn" onclick="toggleYear('${y.year}')">·∫®n/Hi·ªán</button>
        </div>

        <div class="grid cols-2" id="wrap-${cssId(y.year)}">
          <div class="card">
            <div class="page-title" style="font-size:16px; margin:0 0 10px;">H·ªçc k·ª≥ 1 <span class="badge b-info">V·∫Øng: ${absHK1}</span></div>
            <div class="table-wrap" style="overflow:auto; max-height:360px;">
              <table class="table table-scores">
                <thead>
                  <tr>
                    <th style="width:60px;">STT</th>
                    <th>M√¥n h·ªçc</th>
                    <th>ƒêi·ªÉm 1p</th>
                    <th>ƒêi·ªÉm 1 ti·∫øt</th>
                    <th>ƒêi·ªÉm CK</th>
                    <th>TB m√¥n</th>
                  </tr>
                </thead>
                <tbody>${rowsHK1}</tbody>
              </table>
            </div>
          </div>

          <div class="card">
            <div class="page-title" style="font-size:16px; margin:0 0 10px;">H·ªçc k·ª≥ 2 <span class="badge b-info">V·∫Øng: ${absHK2}</span></div>
            <div class="table-wrap" style="overflow:auto; max-height:360px;">
              <table class="table table-scores">
                <thead>
                  <tr>
                    <th style="width:60px;">STT</th>
                    <th>M√¥n h·ªçc</th>
                    <th>ƒêi·ªÉm 1p</th>
                    <th>ƒêi·ªÉm 1 ti·∫øt</th>
                    <th>ƒêi·ªÉm CK</th>
                    <th>TB m√¥n</th>
                  </tr>
                </thead>
                <tbody>${rowsHK2}</tbody>
              </table>
            </div>
          </div>
        </div>
      </section>`;
    }

    function cssId(text){ return text.replace(/\s|-/g,''); }
    function scoreClass(v){
      if (v >= 8) return 'score-excellent';
      if (v >= 6.5) return 'score-good';
      if (v >= 5) return 'score-average';
      return 'score-weak';
    }

    function renderYears(s){
      const container = document.getElementById('years');
      container.innerHTML = s.years.map(yearBlock).join('');
    }

    function toggleYear(year){
      const id = 'wrap-' + cssId(year);
      const box = document.getElementById(id);
      if(!box) return;
      box.style.display = box.style.display === 'none' ? '' : 'none';
    }

    function doSearch(){
      const q = (document.getElementById('q').value || '').trim().toLowerCase();
      if(!q){ document.getElementById('no-data').style.display='block'; document.getElementById('result').style.display='none'; return; }
      const s = STUDENTS.find(st => st.id.toLowerCase()===q || st.name.toLowerCase().includes(q));
      if(!s){
        document.getElementById('no-data').style.display='block';
        document.getElementById('result').style.display='none';
        return;
      }
      document.getElementById('no-data').style.display='none';
      document.getElementById('result').style.display='block';
      fillProfile(s);
      renderYears(s);
    }

    document.getElementById('btn-search').addEventListener('click', doSearch);
    document.getElementById('q').addEventListener('keydown', e=>{ if(e.key==='Enter') doSearch(); });
    document.getElementById('btn-print').addEventListener('click', ()=>window.print());

    window.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('q').value = '24001';
      doSearch();
    });
  </script>
</body>
</html>
